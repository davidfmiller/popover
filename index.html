<!DOCTYPE html>
<html lang="en">
<head>
<title>Popover</title>
<meta charset="utf-8">
<meta name="viewport" value="width=550">

<style>

.rmr-popover.rmr {
  background: transparent;
  border: 1px solid #888;
  box-sizing: border-box;
}

.rmr-popover.rmr .bd {
  width: 100px;
  height: 67px;
  padding: 0;
  background: url(assets/moma.jpg);
  background-size: 100px 67px;
  padding: 0;
}

.rmr-popover.github { background: transparent; }
.rmr-popover.github .bd {
  background: #fff url(assets/github.png) no-repeat;
  background-size: 57px 57px;
  width: 57px;
  height: 57px;
  border: 5px solid #222;
  padding: 0;
}

.test {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
}

.test span {
  position: absolute;
  top: 200px;
  width: 50px;
  height: 50px;
  background: #f8f8f8;
  cursor: pointer;
  transition: background 0.2s;
}

.rmr-popover.important .bd {
  background: red;
}

.rmr-popover.important b {
  border-top-color: red;
}

.test .west {
  left: 0;
}

.test .east {
  right: 0;
}

.test:hover {
  background: #ddd;
}

</style>

<link rel="stylesheet" type="text/css" href="http://davidfmiller.github.io/man-css/man.css">

<link rel="stylesheet" type="text/css" href="src/popover.css">

</head>
<body>

<div id="doc">
  <h1><a tabindex="1" href="https://github.com/davidfmiller/popover/" title="Popover" data-popover='{"content":"This is a simple popover"}'><i>üí¨</i>popover</a></h1>
  <p>
    &hellip; is a simple
    JavaScript
    <em tabindex="1" data-popover="module">module</em>
    to create popover <em tabindex="2" data-popover='{"content":"widgets"}'>things</em>. View the <a data-popover="üìï" title="README" tabindex="3" href="https://github.com/davidfmiller/popover/blob/master/README.md">README</a> for more info.
  </p>

  <p><em tabindex="4" data-popover='{"class":"rmr"}'>Example</em>:</p>

  <pre tabindex="5" data-popover="Example Popover implementation"><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;<a class="s" href="src/popover.css">popover.css</a>&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;<a href="src/popover.js" class="s">src/popover.js</a>&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="kd">var</span> <span class="nx">popover</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Popover</span><span class="p">();</span>
  <span class="nx">popover</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span>
    <span class="s1">&#39;pop&#39;</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">popover</span><span class="p">)</span> <span class="p">{</span> <span class="nb">window</span><span class="p">.</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">popover</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">).</span><span class="nx">on</span><span class="p">(</span>
    <span class="s1">&#39;unpop&#39;</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">popover</span><span class="p">)</span> <span class="p">{</span> <span class="nb">window</span><span class="p">.</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;unpop&#39;</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">popover</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">);</span>
<span class="nt">&lt;/script&gt;</span></pre>

  <p>(View your browser console&rsquo;s log for example output after having viewed this page&rsquo;s popovers.)</p>

  <h2>Configuring Popover Behaviour</h2>
  <p>
    Creating a Popover controller with no arguments passed to the initializer will initialize a controller with default behaviour. However, the class&rsquo; constructor accepts an optional argument to customize its behaviour.
  </p>

  <h3>Attribute Initialization</h3>
  <p>
    By default popover content is retrieved from the target&rsquo;s <code>data-popover</code> attribute, either as a simple string or a serialized JSON object, ex:
  </p>

  <pre><span class="c">// equivalent</span>
<span class="nt">&lt;span</span> <span class="na">data-popover=</span><span class="s">&#39;{&quot;content&quot;:&quot;stuff&quot;}&#39;</span><span class="nt">&gt;</span><span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">data-popover=</span><span class="s">&quot;stuff&quot;</span><span class="nt">&gt;</span><span class="nt">&lt;/span&gt;</span></pre>

  <p>In most instances, using a simple string attribute will be sufficient. However, in cases where you want to style a popover or add other hooks, it&rsquo;s possible to apply a CSS class, <em style="border-bottom: 1px dotted #ddd;" data-popover='{"content" : "This is a very important popover", "class" : "important"}'>for example</em>:</p>

  <pre>
<span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
<span class="nc">.rmr-popover.important</span> <span class="nc">.bd</span>    <span class="p">{</span> <span class="k">background</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span> <span class="p">}</span>
<span class="nc">.rmr-popover.important</span> <span class="nc">.arrow</span> <span class="p">{</span> <span class="k">border-top-color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
<span class="c">...</span>
<span class="nt">&lt;em</span> <span class="na">data-popover=</span><span class="s">&#39;{&quot;content&quot;:&quot;This is a very important popover&quot;,&quot;class&quot;:&quot;important&quot;}&#39;</span><span class="nt">&gt;</span>‚ÄºÔ∏è<span class="nt">&lt;/em&gt;</span></pre>

  <h3>JavaScript Content</h3>
  <p>
    Rather than relying on node attributes to populate popovers, you may instead provide a <code>factory</code> method in the constructor&rsquo;s options to programmatically create popovers. The factory method receives the popover&rsquo;s target node as its sole parameter:
  </p>

<pre><span class="kd">var</span> <span class="nx">pop</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Popover</span><span class="p">({</span>
  <span class="nx">root</span> <span class="o">:</span> <span class="s1">&#39;#doc&#39;</span><span class="p">,</span>
  <span class="nx">factory</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">targetNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="s1">&#39;content&#39;</span> <span class="o">:</span> <span class="nx">globalLookup</span><span class="p">(</span><span class="nx">targetNode</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre>

  <h3>Target Nodes</h3>
  <p>
    When creating a new Popover object <em>all</em> nodes under <code>document.body</code> are inspected. To restrict the search to a portion of the document pass an instance of <code>HTMLNode</code> or a query selector string to the initializer config:
  </p>

  <pre><span class="k">new</span> <span class="nx">Popover</span><span class="p">({</span> <span class="nx">root</span> <span class="o">:</span> <span class="s1">&#39;#doc&#39;</span> <span class="p">});</span> <span class="c">// new Popover({ root : document.getElementById('doc') });</span></pre>

  <h3>Timing</h3>
  <p>
    By default the popovers will appear and disappear a brief period of time after the target element is either hovered over or receives focus. This timing can be modified with the following options to the initializer:
  </p>

  <dl>
    <dt><code>delay.pop</code></dt>
    <dd>the length of time between <code>mouseenter</code> (or <code>focus</code>) and when the popover will appear (in milliseconds)</dd>
    <dt><code>delay.unpop</code></dt>
    <dd>the length of time between <code>mouseleave</code> (or <code>blur</code>) and when the popover will appear (in milliseconds)</dd>
  </dl>

  <pre><span class="k">new</span> <span class="nx">Popover</span><span class="p">({</span>
   <span class="nx">delay</span> <span class="o">:</span> <span class="p">{</span>
     <span class="nx">pop</span> <span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// wait one second before popover appears</span>
     <span class="nx">unpop</span> <span class="o">:</span> <span class="mi">0</span>   <span class="c1">// disappear immediately</span>
  <span class="p">}</span>
<span class="p">});</span></pre>

  <h3>Enabling/disabling</h3>
  <p>
    Once created, popovers can be temporarily turned on and off by setting the <code>`enabled`</code> property to <code><span class="vg">true</span></code> or <code><span class="vg">false</span></code>, ex:
  </p>

  <pre><span class="nx">popover</span><span class="p">.</span><span class="nx">enabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// temporarily disable popovers</span>

<span class="c">// ...</span>

<span class="nx">popover</span><span class="p">.</span><span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c">// re-enable popovers</span></pre>

  <p>To permanently disable (&amp; remove) popovers and clean up the listeners that have been attached to the relevant nodes, invoke the <code>destroy</code> method:</p>

  <pre>popover.destroy();</pre>

  <hr>

  <h2 id="releases"><a href="#releases" title="Release Notes" data-popover='{ "content" : "Release Notes", "persist" : true }'>#</a>Release Notes</h2>
  <dl>
    <dt>v0.1.3</dt>
    <dd>Checks on popover creation &amp; removal</dd>
    <dd>Prevent horizontal clipping</dd>
    <dd>Added <code>destroy</code> method to remove listeners</dd>
    <dd>Added <code>debug</code> option</dd>
    <dd>Added <code>persistent</code> attribute</dd>
    <dd>Reposition persistent popovers on window resize</dd>
  </dl>

  <hr>

  <h2 id="todo"><a href="#todo" data-popover='{ "content" : "TODO", "persist" : true }'>#</a>TODO</h2>
  <ul>
    <li>Prevent vertical clipping</li>
    <li>Horizontal orientation</li>
  </ul>

  <hr>

  <p>Hosted by <a id="gh-a" tabindex="6" data-popover='{"class":"github","id":"gh-popover"}' title="GitHub" href="https://github.com/davidfmiller/popover">GitHub</a></p>

</div>

<div class="test">
  <span class="west" data-popover="Long popover content goes here"></span>
  <span class="east" data-popover="Long popover content goes here"></span>
</div>

<script src="src/popover.js"></script>
<script>
  var popover = new Popover(
    {
//      debug : true,
      delay : {
        pop : 500,
        unpop : 0
      }
//      factory : function(node) { return { 'content' : 'abc', 'persist' : true }; }
    }
  );

  popover.on(
    'pop',
    function(target, popover) { window.console.log('pop', target, popover); }
  ).on(
    'unpop',
    function(target, popover) { window.console.log('unpop', target, popover); }
  );
</script>

</body>
</html>
